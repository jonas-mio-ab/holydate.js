var Holydate=function(){this.register={};this.index=""};Holydate.prototype.isNum=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};
Holydate.prototype.strToTime=function(a){var c=[["YMD",/^([0-9]{4})(\W?)(0[1-9]|1[0-2])(\W?)(0[1-9]|[1-2][0-9]|3[0-1])$/],["YDM",/^([0-9]{4})(\W?)(0[1-9]|[1-2][0-9]|3[0-1])(\W?)(0[1-9]|1[0-2])$/],["MDY",/^(0[1-9]|1[0-2])(\W?)(0[1-9]|[1-2][0-9]|3[0-1])(\W?)([0-9]{4})$/],["DMY",/^(0[1-9]|[1-2][0-9]|3[0-1])(\W?)(0[1-9]|1[0-2])(\W?)([0-9]{4})$/]],e;for(e in c){var b=a.match(c[e][1]),d,g,f;if(b){switch(c[e][0]){case "YMD":d=parseInt(b[1],10);g=parseInt(b[3],10);f=parseInt(b[5],10);break;case "YDM":d=parseInt(b[1],
10);g=parseInt(b[5],10);f=parseInt(b[3],10);break;case "MDY":d=parseInt(b[5],10);g=parseInt(b[1],10);f=parseInt(b[3],10);break;case "DMY":d=parseInt(b[5],10),g=parseInt(b[3],10),f=parseInt(b[1],10)}return(new Date(d,g-1,f)).getTime()}}return!1};Holydate.prototype.date=function(){this.register[this.index].type="date";return this};
Holydate.prototype.weekday=function(a){a=parseInt(a,10);if(!this.isNum(a)||1>a)console.error("Invalid weekday number provided, must be an integer 1 (monday) to 7 (sunday)");else return this.register[this.index].type="weekday",this.register[this.index].weekday=a,this};Holydate.prototype.easter=function(){this.register[this.index].type="easter";return this};
Holydate.prototype.month=function(a){a=parseInt(a,10);if(!this.isNum(a)||1>a||12<a)console.error("Invalid month provided, must be an integer 1 to 12");else return this.register[this.index].month=a,this};Holydate.prototype.day=function(a){a=parseInt(a,10);if(!this.isNum(a)||1>a||31<a)console.error("Invalid day number provided, must be an integer 1 to 31");else return this.register[this.index].day=a,this};Holydate.prototype.first=function(){this.register[this.index].occurrence="first";return this};
Holydate.prototype.last=function(){this.register[this.index].occurrence="last";return this};Holydate.prototype.interval=function(a){a=parseInt(a,10);if(!this.isNum(a)||1>a)console.error("Invalid interval provided, must be an integer 1 or greater");else return this.register[this.index].interval=a,this};Holydate.prototype.offset=function(a){a=parseInt(a,10);if(this.isNum(a))return this.register[this.index].offset=a,this;console.error("Invalid offset number provided, must be an integer")};
Holydate.prototype.red=function(){this.register[this.index].red=!0;return this};Holydate.prototype.calcDate=function(a,c,e){c.month?c.day||console.error("Required day is missing for '"+a+"', try adding .day(int)"):console.error("Required month is missing for '"+a+"', try adding .month(int)");return(new Date((new Date(e)).getFullYear(),c.month-1,c.day)).getTime()};
Holydate.prototype.calcEaster=function(a,c){this.isNum(a.offset)||(a.offset=0);var e=(new Date(c)).getFullYear(),b=e%19,d=Math.floor(e/100),g=e%100,f=(19*b+(d-Math.floor(d/4)-Math.floor((d-Math.floor((d+8)/25)+1)/3))+15)%30,d=(32+d%4*2+2*Math.floor(g/4)-f-g%4)%7,b=Math.floor((b+11*f+22*d)/451);return(new Date(e,Math.floor((f+d-7*b+114)/31)-1,(f+d-7*b+114)%31+1+a.offset)).getTime()};
Holydate.prototype.calcWeekday=function(a,c,e){this.isNum(c.month)||console.error("Required month is missing for '"+a+"', try adding .month(int)");c.day=this.isNum(c.day)?c.day:1;c.occurrence=-1<["first","last"].indexOf(c.occurrence)?c.occurrence:"first";c.interval=this.isNum(c.interval)?c.interval:1;var b,d,g;a=new Date(e);b=new Date(a.getFullYear(),c.month-1,"first"===c.occurrence?c.day:1);if("first"===c.occurrence){e=new Date(b.getTime()+6048E5*c.interval);var f=0;for(b=b.getTime();b<=e.getTime();b+=
864E5)if(d=new Date(b),g=0===d.getDay()?7:d.getDay(),f+=g===c.weekday?1:0,a.getMonth()===d.getMonth()&&a.getDate()===d.getDate()&&g===c.weekday&&f===c.interval)return b}else if("last"===c.occurrence)for(e=new Date(b.getFullYear(),b.getMonth()+1,0),e=new Date(e.getTime()),b=b.getTime();b<=e.getTime();b+=864E5)if(d=new Date(b),g=0===d.getDay()?7:d.getDay(),f=g===c.weekday?d.getTime():f,a.getMonth()===d.getMonth()&&a.getDate()===d.getDate()&&g===c.weekday)return f};
Holydate.prototype.set=function(a){if("string"!==typeof a||""===a)console.error("Invalid name provided, must be a string");else return this.index=a,this.register[a]||(this.register[a]={type:null,weekday:null,interval:null,month:null,day:null,occurrence:null,offset:null,red:!1}),this};
Holydate.prototype.get=function(a){var c=this.strToTime(a),e,b=[];if(c){for(e in this.register)a=this.register[e],"date"===a.type&&c===this.calcDate(e,a,c)&&b.push({name:e,red:a.red}),"weekday"===a.type&&c===this.calcWeekday(e,a,c)&&b.push({name:e,red:a.red}),"easter"===a.type&&c===this.calcEaster(a,c)&&b.push({name:e,red:a.red});return 0<b.length?b:null}console.error("Provided date '"+a+"' is invalid")};
